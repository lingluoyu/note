### 线上问题

#### 问题

拜访数据查询失败

##### 解决流程

1. 通过kibana查询线上日志，发现是数据关联失败
2. 通过数据库管理平台查询线上数据，发现拜访表关联的日程表id错误；通过对比发现，拜访表中存储的部分日程id错误
3. 查看数据插入时间和操作人，确定在批量插入时会产生问题
4. 通过测试环境复现问题，失败；生产复现问题，成功复现
5. 询问其他同事，发现在前一天晚上更换了数据库代理
6. 通过本地debug，未发现批量插入时生成id错误，尝试更改线上数据库代理为原链接，问题未出现
7. 通知运维配置数据库代理id生成步长，配置完成后切换到数据库代理链接，问题未出现

##### 复盘

数据库主键id采用自增生成，且测试库、生产库步长均为2，但数据库代理在批量插入数据，返回数据时生成的主键id步长为1，因此插入的数据对应不上，导致数据查询失败。

#### 问题

主数据上传文件失败

##### 解决流程

1. 查询线上日志，发现上传文件接口，文件数据会被修改，导致无法读取
2. 最近上线代码添加了logfilter，会把文件数据转成byte
3. 由于历史原因，主数据实现了一个内部路由，在这个路由filter里将文件请求inputstream转为了bytearray
4. 由于添加logfilter时未指定优先级，使logfilter在routerfilter前执行，导致routerfilter无法获取到正确的文件流
5. 修改routerfilter优先级在loggilter前执行，问题解决

##### 复盘

由于历史原因，自己时间routerfilter，改写了请求中的数据，导致出现了问题，这种问题是可以避免的

